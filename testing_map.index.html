<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Testing</title>
</head>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>

<p>This works here. Why not in map.js?</p>
<p id="bounds-aspect"></p>
<p id="drawn-aspect"></p>
<svg width="600px" height="300px" id="map"></svg>

<script>
    var svg = d3.select("#map").style("border","1px solid #000000");
    var group = svg.append("g");

    var width = 600;
    var height = 300;

    var proj = d3.geoEquirectangular();
    var path = d3.geoPath(proj);

    d3.json("https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_lakes.geojson")
    .then(function(json){
        //set scale and translate of projection so map fits nicely
        proj.fitExtent([[0,0], [100,100]], json);
        
        var bounds = path.bounds(json);
        var bounds_aspect = (bounds[1][1]-bounds[0][1]) / (bounds[1][0]-bounds[0][0]);
        
        d3.select("#bounds-aspect").text("Aspect ratio (height/width) computed using path.bounds(): " + bounds_aspect);
        
        //draw the lakes
        group.selectAll("path").data(json.features).enter().append("path")
            .attr("d", path).attr("stroke","#00aaff");
            
        var bbox = group.node().getBBox();
        var group_aspect = bbox.height/bbox.width;
        
        d3.select("#drawn-aspect").text("Aspect ratio (height/width) getBBox() method: " + group_aspect);
            
    }, function(err){
      alert(err);
    });

</script>